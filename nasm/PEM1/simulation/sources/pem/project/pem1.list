     1                                  ; Name: pem1.asm
     2                                  ; Build: see makefile or
     3                                  ; Description:  PEM1 microprocessor simulation
     4                                  
     5                                  %include "pem1.inc"
     6                              <1> %ifndef _ASM_SLEEP_
     7                              <1> %define _ASM_SLEEP_
     8                              <1> 
     9                              <1> %include "../includes/syscalls.inc"
    10                              <2> %ifndef _ASM_SYSCALLS_INC_
    11                              <2> %define _ASM_SYSCALLS_INC_
    12                              <2> 
    13                              <2>   %define SYS_ACCEPT                 43
    14                              <2>   %define SYS_ACCEPT4                288
    15                              <2>   %define SYS_ACCESS                 21
    16                              <2>   %define SYS_ACCT                   163
    17                              <2>   %define SYS_ADD_KEY                248
    18                              <2>   %define SYS_ADJTIMEX               159
    19                              <2>   %define SYS_AFS_SYSCALL            183
    20                              <2>   %define SYS_ALARM                  37
    21                              <2>   %define SYS_ARCH_PRCTL             158
    22                              <2>   %define SYS_BIND                   49
    23                              <2>   %define SYS_BRK                    12
    24                              <2>   %define SYS_CAPGET                 125
    25                              <2>   %define SYS_CAPSET                 126
    26                              <2>   %define SYS_CHDIR                  80 
    27                              <2>   %define SYS_CHMOD                  90 
    28                              <2>   %define SYS_CHOWN                  92 
    29                              <2>   %define SYS_CHROOT                 161
    30                              <2>   %define SYS_CLOCK_GETRES           229
    31                              <2>   %define SYS_CLOCK_GETTIME          228
    32                              <2>   %define SYS_CLOCK_NANOSLEEP        230
    33                              <2>   %define SYS_CLOCK_SETTIME          227
    34                              <2>   %define SYS_CLONE                  56
    35                              <2>   %define SYS_CLOSE                  3
    36                              <2>   %define SYS_CONNECT                42
    37                              <2>   %define SYS_CREAT                  85
    38                              <2>   %define SYS_CREATE_MODULE          174
    39                              <2>   %define SYS_DELETE_MODULE          176
    40                              <2>   %define SYS_DUP                    32
    41                              <2>   %define SYS_DUP2                   33
    42                              <2>   %define SYS_DUP3                   292
    43                              <2>   %define SYS_EPOLL_CREATE           213
    44                              <2>   %define SYS_EPOLL_CREATE1          291
    45                              <2>   %define SYS_EPOLL_CTL              233
    46                              <2>   %define SYS_EPOLL_CTL_OLD          214
    47                              <2>   %define SYS_EPOLL_PWAIT            281
    48                              <2>   %define SYS_EPOLL_WAIT             232
    49                              <2>   %define SYS_EPOLL_WAIT_OLD         215
    50                              <2>   %define SYS_EVENTFD                284
    51                              <2>   %define SYS_EVENTFD2               290
    52                              <2>   %define SYS_EXECVE                 59
    53                              <2>   %define SYS_EXIT                   60
    54                              <2>   %define SYS_EXIT_GROUP             231
    55                              <2>   %define SYS_FACCESSAT              269
    56                              <2>   %define SYS_FADVISE64              221
    57                              <2>   %define SYS_FALLOCATE              285
    58                              <2>   %define SYS_FANOTIFY_INIT          300
    59                              <2>   %define SYS_FANOTIFY_MARK          301
    60                              <2>   %define SYS_FCHDIR                 81
    61                              <2>   %define SYS_FCHMOD                 91
    62                              <2>   %define SYS_FCHMODAT               268
    63                              <2>   %define SYS_FCHOWN                 93 
    64                              <2>   %define SYS_FCHOWNAT               260
    65                              <2>   %define SYS_FCNTL                  72 
    66                              <2>   %define SYS_FDATASYNC              75 
    67                              <2>   %define SYS_FGETXATTR              193
    68                              <2>   %define SYS_FLISTXATTR             196
    69                              <2>   %define SYS_FLOCK                  73 
    70                              <2>   %define SYS_FORK                   57 
    71                              <2>   %define SYS_FREMOVEXATTR           199
    72                              <2>   %define SYS_FSETXATTR              190
    73                              <2>   %define SYS_FSTAT                  5  
    74                              <2>   %define SYS_FSTATFS                138
    75                              <2>   %define SYS_FSYNC                  74 
    76                              <2>   %define SYS_FTRUNCATE              77 
    77                              <2>   %define SYS_FUTEX                  202
    78                              <2>   %define SYS_FUTIMESAT              261
    79                              <2>   %define SYS_GET_KERNEL_SYMS        177
    80                              <2>   %define SYS_GET_MEMPOLICY          239
    81                              <2>   %define SYS_GET_ROBUST_LIST        274
    82                              <2>   %define SYS_GET_THREAD_AREA        211
    83                              <2>   %define SYS_GETCWD                 79 
    84                              <2>   %define SYS_GETDENTS               78 
    85                              <2>   %define SYS_GETDENTS64             217
    86                              <2>   %define SYS_GETEGID                108
    87                              <2>   %define SYS_GETEUID                107
    88                              <2>   %define SYS_GETGID                 104
    89                              <2>   %define SYS_GETGROUPS              115
    90                              <2>   %define SYS_GETITIMER              36 
    91                              <2>   %define SYS_GETPEERNAME            52 
    92                              <2>   %define SYS_GETPGID                121
    93                              <2>   %define SYS_GETPGRP                111
    94                              <2>   %define SYS_GETPID                 39 
    95                              <2>   %define SYS_GETPMSG                181
    96                              <2>   %define SYS_GETPPID                110
    97                              <2>   %define SYS_GETPRIORITY            140
    98                              <2>   %define SYS_GETRESGID              120
    99                              <2>   %define SYS_GETRESUID              118
   100                              <2>   %define SYS_GETRLIMIT              97 
   101                              <2>   %define SYS_GETRUSAGE              98 
   102                              <2>   %define SYS_GETSID                 124
   103                              <2>   %define SYS_GETSOCKNAME            51 
   104                              <2>   %define SYS_GETSOCKOPT             55 
   105                              <2>   %define SYS_GETTID                 186
   106                              <2>   %define SYS_GETTIMEOFDAY           96 
   107                              <2>   %define SYS_GETUID                 102
   108                              <2>   %define SYS_GETXATTR               191
   109                              <2>   %define SYS_INIT_MODULE            175
   110                              <2>   %define SYS_INOTIFY_ADD_WATCH      254
   111                              <2>   %define SYS_INOTIFY_INIT           253
   112                              <2>   %define SYS_INOTIFY_INIT1          294
   113                              <2>   %define SYS_INOTIFY_RM_WATCH       255
   114                              <2>   %define SYS_IO_CANCEL              210
   115                              <2>   %define SYS_IO_DESTROY             207
   116                              <2>   %define SYS_IO_GETEVENTS           208
   117                              <2>   %define SYS_IO_SETUP               206
   118                              <2>   %define SYS_IO_SUBMIT              209
   119                              <2>   %define SYS_IOCTL                  16 
   120                              <2>   %define SYS_IOPERM                 173
   121                              <2>   %define SYS_IOPL                   172
   122                              <2>   %define SYS_IOPRIO_GET             252
   123                              <2>   %define SYS_IOPRIO_SET             251
   124                              <2>   %define SYS_KEXEC_LOAD             246
   125                              <2>   %define SYS_KEYCTL                 250
   126                              <2>   %define SYS_KILL                   62
   127                              <2>   %define SYS_LCHOWN                 94 
   128                              <2>   %define SYS_LGETXATTR              192
   129                              <2>   %define SYS_LINK                   86 
   130                              <2>   %define SYS_LINKAT                 265
   131                              <2>   %define SYS_LISTEN                 50 
   132                              <2>   %define SYS_LISTXATTR              194
   133                              <2>   %define SYS_LLISTXATTR             195
   134                              <2>   %define SYS_LOOKUP_DCOOKIE         212
   135                              <2>   %define SYS_LREMOVEXATTR           198
   136                              <2>   %define SYS_LSEEK                  8  
   137                              <2>   %define SYS_LSETXATTR              189
   138                              <2>   %define SYS_LSTAT                  6
   139                              <2>   %define SYS_MADVISE                28 
   140                              <2>   %define SYS_MBIND                  237
   141                              <2>   %define SYS_MIGRATE_PAGES          256
   142                              <2>   %define SYS_MINCORE                27 
   143                              <2>   %define SYS_MKDIR                  83 
   144                              <2>   %define SYS_MKDIRAT                258
   145                              <2>   %define SYS_MKNOD                  133
   146                              <2>   %define SYS_MKNODAT                259
   147                              <2>   %define SYS_MLOCK                  149
   148                              <2>   %define SYS_MLOCKALL               151
   149                              <2>   %define SYS_MMAP                   9  
   150                              <2>   %define SYS_MODIFY_LDT             154
   151                              <2>   %define SYS_MOUNT                  165
   152                              <2>   %define SYS_MOVE_PAGES             279
   153                              <2>   %define SYS_MPROTECT               10 
   154                              <2>   %define SYS_MQ_GETSETATTR          245
   155                              <2>   %define SYS_MQ_NOTIFY              244
   156                              <2>   %define SYS_MQ_OPEN                240
   157                              <2>   %define SYS_MQ_TIMEDRECEIVE        243
   158                              <2>   %define SYS_MQ_TIMEDSEND           242
   159                              <2>   %define SYS_MQ_UNLINK              241
   160                              <2>   %define SYS_MREMAP                 25 
   161                              <2>   %define SYS_MSGCTL                 71 
   162                              <2>   %define SYS_MSGGET                 68
   163                              <2>   %define SYS_MSGRCV                 70
   164                              <2>   %define SYS_MSGSND                 69
   165                              <2>   %define SYS_MSYNC                  26
   166                              <2>   %define SYS_MUNLOCK                150
   167                              <2>   %define SYS_MUNLOCKALL             152
   168                              <2>   %define SYS_MUNMAP                 11 
   169                              <2>   %define SYS_NANOSLEEP              35
   170                              <2>   %define SYS_NEWFSTATAT             262
   171                              <2>   %define SYS_NFSSERVCTL             180
   172                              <2>   %define SYS_OPEN                   2
   173                              <2>   %define SYS_OPENAT                 257
   174                              <2>   %define SYS_PAUSE                  34 
   175                              <2>   %define SYS_PERF_EVENT_OPEN        298
   176                              <2>   %define SYS_PERSONALITY            135
   177                              <2>   %define SYS_PIPE                   22 
   178                              <2>   %define SYS_PIPE2                  293
   179                              <2>   %define SYS_PIVOT_ROOT             155
   180                              <2>   %define SYS_POLL                   7  
   181                              <2>   %define SYS_PPOLL                  271
   182                              <2>   %define SYS_PRCTL                  157
   183                              <2>   %define SYS_PREAD64                17 
   184                              <2>   %define SYS_PREADV                 295
   185                              <2>   %define SYS_PRLIMIT64              302
   186                              <2>   %define SYS_PSELECT6               270
   187                              <2>   %define SYS_PTRACE                 101
   188                              <2>   %define SYS_PUTPMSG                182
   189                              <2>   %define SYS_PWRITE64               18 
   190                              <2>   %define SYS_PWRITEV                296
   191                              <2>   %define SYS_QUERY_MODULE           178
   192                              <2>   %define SYS_QUOTACTL               179
   193                              <2>   %define SYS_READ                   0  
   194                              <2>   %define SYS_READAHEAD              187
   195                              <2>   %define SYS_READLINK               89 
   196                              <2>   %define SYS_READLINKAT             267
   197                              <2>   %define SYS_READV                  19 
   198                              <2>   %define SYS_REBOOT                 169
   199                              <2>   %define SYS_RECVFROM               45 
   200                              <2>   %define SYS_RECVMMSG               299
   201                              <2>   %define SYS_RECVMSG                47 
   202                              <2>   %define SYS_REMAP_FILE_PAGES       216
   203                              <2>   %define SYS_REMOVEXATTR            197
   204                              <2>   %define SYS_RENAME                 82 
   205                              <2>   %define SYS_RENAMEAT               264
   206                              <2>   %define SYS_REQUEST_KEY            249
   207                              <2>   %define SYS_RESTART_SYSCALL        219
   208                              <2>   %define SYS_RMDIR                  84 
   209                              <2>   %define SYS_RT_SIGACTION           13
   210                              <2>   %define SYS_RT_SIGPENDING          127
   211                              <2>   %define SYS_RT_SIGPROCMASK         14 
   212                              <2>   %define SYS_RT_SIGQUEUEINFO        129
   213                              <2>   %define SYS_RT_SIGRETURN           15 
   214                              <2>   %define SYS_RT_SIGSUSPEND          130
   215                              <2>   %define SYS_RT_SIGTIMEDWAIT        128
   216                              <2>   %define SYS_RT_TGSIGQUEUEINFO      297
   217                              <2>   %define SYS_SCHED_GET_PRIORITY_MAX 146
   218                              <2>   %define SYS_SCHED_GET_PRIORITY_MIN 147
   219                              <2>   %define SYS_SCHED_GETAFFINITY      204
   220                              <2>   %define SYS_SCHED_GETPARAM         143
   221                              <2>   %define SYS_SCHED_GETSCHEDULER     145
   222                              <2>   %define SYS_SCHED_RR_GET_INTERVAL  148
   223                              <2>   %define SYS_SCHED_SETAFFINITY      203
   224                              <2>   %define SYS_SCHED_SETPARAM         142
   225                              <2>   %define SYS_SCHED_SETSCHEDULER     144
   226                              <2>   %define SYS_SCHED_YIELD            24 
   227                              <2>   %define SYS_SECURITY               185
   228                              <2>   %define SYS_SELECT                 23 
   229                              <2>   %define SYS_SEMCTL                 66 
   230                              <2>   %define SYS_SEMGET                 64 
   231                              <2>   %define SYS_SEMOP                  65 
   232                              <2>   %define SYS_SEMTIMEDOP             220
   233                              <2>   %define SYS_SENDFILE               40 
   234                              <2>   %define SYS_SENDMSG                46 
   235                              <2>   %define SYS_SENDTO                 44 
   236                              <2>   %define SYS_SET_MEMPOLICY          238
   237                              <2>   %define SYS_SET_ROBUST_LIST        273
   238                              <2>   %define SYS_SET_THREAD_AREA        205
   239                              <2>   %define SYS_SET_TID_ADDRESS        218
   240                              <2>   %define SYS_SETDOMAINNAME          171
   241                              <2>   %define SYS_SETFSGID               123
   242                              <2>   %define SYS_SETFSUID               122
   243                              <2>   %define SYS_SETGID                 106
   244                              <2>   %define SYS_SETGROUPS              116
   245                              <2>   %define SYS_SETHOSTNAME            170
   246                              <2>   %define SYS_SETITIMER              38 
   247                              <2>   %define SYS_SETPGID                109
   248                              <2>   %define SYS_SETPRIORITY            141
   249                              <2>   %define SYS_SETREGID               114
   250                              <2>   %define SYS_SETRESGID              119
   251                              <2>   %define SYS_SETRESUID              117
   252                              <2>   %define SYS_SETREUID               113
   253                              <2>   %define SYS_SETRLIMIT              160
   254                              <2>   %define SYS_SETSID                 112
   255                              <2>   %define SYS_SETSOCKOPT             54 
   256                              <2>   %define SYS_SETTIMEOFDAY           164
   257                              <2>   %define SYS_SETUID                 105
   258                              <2>   %define SYS_SETXATTR               188
   259                              <2>   %define SYS_SHMAT                  30 
   260                              <2>   %define SYS_SHMCTL                 31 
   261                              <2>   %define SYS_SHMDT                  67 
   262                              <2>   %define SYS_SHMGET                 29 
   263                              <2>   %define SYS_SHUTDOWN               48 
   264                              <2>   %define SYS_SIGALTSTACK            131
   265                              <2>   %define SYS_SIGNALFD               282
   266                              <2>   %define SYS_SIGNALFD4              289
   267                              <2>   %define SYS_SOCKET                 41 
   268                              <2>   %define SYS_SOCKETPAIR             53 
   269                              <2>   %define SYS_SPLICE                 275
   270                              <2>   %define SYS_STAT                   4  
   271                              <2>   %define SYS_STATFS                 137
   272                              <2>   %define SYS_SWAPOFF                168
   273                              <2>   %define SYS_SWAPON                 167
   274                              <2>   %define SYS_SYMLINK                88 
   275                              <2>   %define SYS_SYMLINKAT              266
   276                              <2>   %define SYS_SYNC                   162
   277                              <2>   %define SYS_SYNC_FILE_RANGE        277
   278                              <2>   %define SYS__SYSCTL                156
   279                              <2>   %define SYS_SYSFS                  139
   280                              <2>   %define SYS_SYSINFO                99 
   281                              <2>   %define SYS_SYSLOG                 103
   282                              <2>   %define SYS_TEE                    276
   283                              <2>   %define SYS_TGKILL                 234
   284                              <2>   %define SYS_TIME                   201
   285                              <2>   %define SYS_TIMER_CREATE           222
   286                              <2>   %define SYS_TIMER_DELETE           226
   287                              <2>   %define SYS_TIMER_GETOVERRUN       225
   288                              <2>   %define SYS_TIMER_GETTIME          224
   289                              <2>   %define SYS_TIMER_SETTIME          223
   290                              <2>   %define SYS_TIMERFD_CREATE         283
   291                              <2>   %define SYS_TIMERFD_GETTIME        287
   292                              <2>   %define SYS_TIMERFD_SETTIME        286
   293                              <2>   %define SYS_TIMES                  100
   294                              <2>   %define SYS_TKILL                  200
   295                              <2>   %define SYS_TRUNCATE               76 
   296                              <2>   %define SYS_TUXCALL                184
   297                              <2>   %define SYS_UMASK                  95 
   298                              <2>   %define SYS_UMOUNT2                166
   299                              <2>   %define SYS_UNAME                  63 
   300                              <2>   %define SYS_UNLINK                 87 
   301                              <2>   %define SYS_UNLINKAT               263
   302                              <2>   %define SYS_UNSHARE                272
   303                              <2>   %define SYS_USELIB                 134
   304                              <2>   %define SYS_USTAT                  136
   305                              <2>   %define SYS_UTIME                  132
   306                              <2>   %define SYS_UTIMENSAT              280
   307                              <2>   %define SYS_UTIMES                 235
   308                              <2>   %define SYS_VFORK                  58 
   309                              <2>   %define SYS_VHANGUP                153
   310                              <2>   %define SYS_VMSPLICE               278
   311                              <2>   %define SYS_VSERVER                236
   312                              <2>   %define SYS_WAIT4                  61
   313                              <2>   %define SYS_WAITID                 247
   314                              <2>   %define SYS_WRITE                  1
   315                              <2>   %define SYS_WRITEV                 20
   316                              <2> 
   317                              <2> %elif
   318                              <2>      %warning "syscalls.inc already included" 
   319                              <2> %endif
   320                              <1> %include "../includes/termio.inc"
   321                              <2> %ifndef _ASM_TERMIO_INC_
   322                              <2> %define _ASM_TERMIO_INC_
   323                              <2> 
   324                              <2> ; possible input and output devices for the konsole
   325                              <2> 
   326                              <2> %define STDIN   0
   327                              <2> %define STDOUT  1
   328                              <2> %define STDERR  2
   329                              <2> 
   330                              <2> ;IOCTL values
   331                              <2> %define TCGETS      5401h	; termios instruction to read flags
   332                              <2> %define TCSETS      5402h	; termios instruction to write flags
   333                              <2> %define TIOCGWINSZ  5413h	; winsize
   334                              <2> 
   335                              <2> %define ICANON       2
   336                              <2> %define ECHO        10
   337                              <2> 
   338                              <2> ; *** STRUCTURES ***
   339                              <2> 
   340                              <2> STRUC TERMIOS_STRUC
   341 00000000 <res 00000004>      <2>     .c_iflag:   resd    1   ; input mode flags
   342 00000004 <res 00000004>      <2>     .c_oflag:   resd    1   ; output mode flags
   343 00000008 <res 00000004>      <2>     .c_cflag:   resd    1   ; control mode flags
   344 0000000C <res 00000004>      <2>     .c_lflag:   resd    1   ; local mode flags
   345 00000010 <res 00000001>      <2>     .c_line:    resb    1   ; line discipline
   346 00000011 <res 00000013>      <2>     .c_cc:      resb    19  ; control characters
   347                              <2> ENDSTRUC
   348                              <2> 
   349                              <2> STRUC WINSIZE_STRUC
   350 00000000 <res 00000008>      <2>     .rows:      resq    1
   351 00000008 <res 00000008>      <2>     .cols:      resq    1
   352 00000010 <res 00000008>      <2>     .xpixels:   resq    1       ; not used
   353 00000018 <res 00000008>      <2>     .ypixels:   resq    1       ; not used
   354                              <2> ENDSTRUC
   355                              <2> 
   356                              <2> ; *** MACROS ***
   357                              <2> 
   358                              <2> %macro TERMIOS 1
   359                              <2>     %1: ISTRUC TERMIOS_STRUC
   360                              <2>         at TERMIOS_STRUC.c_iflag, dd 0
   361                              <2>         at TERMIOS_STRUC.c_oflag, dd 0
   362                              <2>         at TERMIOS_STRUC.c_cflag, dd 0
   363                              <2>         at TERMIOS_STRUC.c_lflag, dd 0
   364                              <2>         at TERMIOS_STRUC.c_line,  db 0
   365                              <2>         at TERMIOS_STRUC.c_cc,    times 19 db 0
   366                              <2>     IEND
   367                              <2>     %define %1.c_iflag %1+TERMIOS_STRUC.c_iflag
   368                              <2>     %define %1.c_oflag %1+TERMIOS_STRUC.c_oflag
   369                              <2>     %define %1.c_cflag %1+TERMIOS_STRUC.c_cflag
   370                              <2>     %define %1.c_lflag %1+TERMIOS_STRUC.c_lflag
   371                              <2>     %define %1.c_line %1+TERMIOS_STRUC.c_line
   372                              <2>     %define %1.c_cc %1+TERMIOS_STRUC.c_cc
   373                              <2> %endmacro
   374                              <2> 
   375                              <2> %macro WINSIZE 1
   376                              <2>     %1: ISTRUC WINSIZE_STRUC
   377                              <2>             at WINSIZE_STRUC.rows,    dq 0
   378                              <2>             at WINSIZE_STRUC.cols,    dq 0
   379                              <2>             at WINSIZE_STRUC.xpixels, dq 0
   380                              <2>             at WINSIZE_STRUC.ypixels, dq 0
   381                              <2>         IEND
   382                              <2>     %define %1.rows     %1+WINSIZE_STRUC.rows
   383                              <2>     %define %1.cols     %1+WINSIZE_STRUC.cols
   384                              <2>     %define %1.xpixels  %1+WINSIZE_STRUC.xpixels
   385                              <2>     %define %1.ypixels  %1+WINSIZE_STRUC.ypixels 
   386                              <2> %endmacro
   387                              <2> 
   388                              <2> %elif
   389                              <2>     %warning "termio.inc already included"
   390                              <2> %endif
   391                              <1> %include "../includes/time.inc"
   392                              <2> %ifndef _ASM_TIME_INC_
   393                              <2> %define _ASM_TIME_INC_
   394                              <2> 
   395                              <2> %define CLOCK_REALTIME 0
   396                              <2> 
   397                              <2> STRUC TIMESPEC_STRUC
   398 00000000 <res 00000008>      <2>   .tv_sec:      resq    1
   399 00000008 <res 00000008>      <2>   .tv_nsec:     resq    1
   400                              <2> ENDSTRUC
   401                              <2> 
   402                              <2> ; TIMESPEC takes one mandatory parameter %1 which is the name of the data structure.
   403                              <2> ; The second and third refers to secs and nanosecs respectively and aren't mandatory.
   404                              <2> ; When no value is given for seconds and/or nanoseconds they defaults to zero.
   405                              <2> %macro TIMESPEC 1-3 0,0
   406                              <2>     %1:  ISTRUC TIMESPEC_STRUC
   407                              <2>         at  TIMESPEC_STRUC.tv_sec,     dq %2
   408                              <2>         at  TIMESPEC_STRUC.tv_nsec,    dq %3
   409                              <2>     IEND
   410                              <2> 
   411                              <2>     %define %1.tv_sec   %1+TIMESPEC_STRUC.tv_sec
   412                              <2>     %define %1.tv_nsec  %1+TIMESPEC_STRUC.tv_nsec
   413                              <2> %endmacro
   414                              <2> 
   415                              <2> %elif
   416                              <2>   %warning "time.inc already included"
   417                              <2> %endif
   418                              <1> %include "../includes/errors.inc"
   419                              <2> %ifndef _ASM_ERRNO_INC_
   420                              <2> %define _ASM_ERRNO_INC_
   421                              <2> 
   422                              <2>   %define   ENOERR          0        ; no error, implemented by myself
   423                              <2>   %define   EPERM           1        ; Operation not permitted 
   424                              <2>   %define   ENOENT          2        ; No such file or directory 
   425                              <2>   %define   ESRCH           3        ; No such process 
   426                              <2>   %define   EINTR           4        ; Interrupted system call 
   427                              <2>   %define   EIO             5        ; I/O error 
   428                              <2>   %define   ENXIO           6        ; No such device or address 
   429                              <2>   %define   E2BIG           7        ; Argument list too long 
   430                              <2>   %define   ENOEXEC         8        ; Exec format error 
   431                              <2>   %define   EBADF           9        ; Bad file number 
   432                              <2>   %define   ECHILD         10        ; No child processes 
   433                              <2>   %define   EAGAIN         11        ; Try again 
   434                              <2>   %define   ENOMEM         12        ; Out of memory 
   435                              <2>   %define   EACCES         13        ; Permission denied 
   436                              <2>   %define   EFAULT         14        ; Bad address 
   437                              <2>   %define   ENOTBLK        15        ; Block device required 
   438                              <2>   %define   EBUSY          16        ; Device or resource busy 
   439                              <2>   %define   EEXIST         17        ; File exists 
   440                              <2>   %define   EXDEV          18        ; Cross-device link 
   441                              <2>   %define   ENODEV         19        ; No such device 
   442                              <2>   %define   ENOTDIR        20        ; Not a directory 
   443                              <2>   %define   EISDIR         21        ; Is a directory 
   444                              <2>   %define   EINVAL         22        ; Invalid argument 
   445                              <2>   %define   ENFILE         23        ; File table overflow 
   446                              <2>   %define   EMFILE         24        ; Too many open files 
   447                              <2>   %define   ENOTTY         25        ; Not a typewriter 
   448                              <2>   %define   ETXTBSY        26        ; Text file busy 
   449                              <2>   %define   EFBIG          27        ; File too large 
   450                              <2>   %define   ENOSPC         28        ; No space left on device 
   451                              <2>   %define   ESPIPE         29        ; Illegal seek 
   452                              <2>   %define   EROFS          30        ; Read-only file system 
   453                              <2>   %define   EMLINK         31        ; Too many links 
   454                              <2>   %define   EPIPE          32        ; Broken pipe 
   455                              <2>   %define   EDOM           33        ; Math argument out of domain of func 
   456                              <2>   %define   ERANGE         34        ; Math result not representable 
   457                              <2>   %define   EDEADLK        35        ; Resource deadlock would occur
   458                              <2>   %define   ENAMETOOLONG   36        ; File name too long
   459                              <2>   %define   ENOLCK         37        ; No record locks available
   460                              <2>   %define   ENOSYS         38        ; Function not implemented
   461                              <2>   %define   ENOTEMPTY      39        ; Directory not empty
   462                              <2>   %define   ELOOP          40        ; Too many symbolic links encountered
   463                              <2>   %define   EWOULDBLOCK    11        ; Operation would block, same as EAGAIN
   464                              <2>   %define   ENOMSG         42        ; No message of desired type
   465                              <2>   %define   EIDRM          43        ; Identifier removed
   466                              <2>   %define   ECHRNG         44        ; Channel number out of range
   467                              <2>   %define   EL2NSYNC       45        ; Level 2 not synchronized
   468                              <2>   %define   EL3HLT         46        ; Level 3 halted
   469                              <2>   %define   EL3RST         47        ; Level 3 reset
   470                              <2>   %define   ELNRNG         48        ; Link number out of range
   471                              <2>   %define   EUNATCH        49        ; Protocol driver not attached
   472                              <2>   %define   ENOCSI         50        ; No CSI structure available
   473                              <2>   %define   EL2HLT         51        ; Level 2 halted
   474                              <2>   %define   EBADE          52        ; Invalid exchange
   475                              <2>   %define   EBADR          53        ; Invalid request descriptor
   476                              <2>   %define   EXFULL         54        ; Exchange full
   477                              <2>   %define   ENOANO         55        ; No anode
   478                              <2>   %define   EBADRQC        56        ; Invalid request code
   479                              <2>   %define   EBADSLT        57        ; Invalid slot
   480                              <2>   %define   EDEADLOCK      35        ; Resource deadlock would occur, same as EDEADLK
   481                              <2>   %define   EBFONT         59        ; Bad font file format
   482                              <2>   %define   ENOSTR         60        ; Device not a stream
   483                              <2>   %define   ENODATA        61        ; No data available
   484                              <2>   %define   ETIME          62        ; Timer expired
   485                              <2>   %define   ENOSR          63        ; Out of streams resources
   486                              <2>   %define   ENONET         64        ; Machine is not on the network
   487                              <2>   %define   ENOPKG         65        ; Package not installed
   488                              <2>   %define   EREMOTE        66        ; Object is remote
   489                              <2>   %define   ENOLINK        67        ; Link has been severed
   490                              <2>   %define   EADV           68        ; Advertise error
   491                              <2>   %define   ESRMNT         69        ; Srmount error
   492                              <2>   %define   ECOMM          70        ; Communication error on send
   493                              <2>   %define   EPROTO         71        ; Protocol error
   494                              <2>   %define   EMULTIHOP      72        ; Multihop attempted
   495                              <2>   %define   EDOTDOT        73        ; RFS specific error
   496                              <2>   %define   EBADMSG        74        ; Not a data message
   497                              <2>   %define   EOVERFLOW      75        ; Value too large for defined data type
   498                              <2>   %define   ENOTUNIQ       76        ; Name not unique on network
   499                              <2>   %define   EBADFD         77        ; File descriptor in bad state
   500                              <2>   %define   EREMCHG        78        ; Remote address changed
   501                              <2>   %define   ELIBACC        79        ; Can not access a needed shared library
   502                              <2>   %define   ELIBBAD        80        ; Accessing a corrupted shared library
   503                              <2>   %define   ELIBSCN        81        ; .lib section in a.out corrupted
   504                              <2>   %define   ELIBMAX        82        ; Attempting to link in too many shared libraries
   505                              <2>   %define   ELIBEXEC       83        ; Cannot exec a shared library directly
   506                              <2>   %define   EILSEQ         84        ; Illegal byte sequence
   507                              <2>   %define   ERESTART       85        ; Interrupted system call should be restarted
   508                              <2>   %define   ESTRPIPE       86        ; Streams pipe error
   509                              <2>   %define   EUSERS         87        ; Too many users
   510                              <2>   %define   ENOTSOCK       88        ; Socket operation on non-socket
   511                              <2>   %define   EDESTADDRREQ   89        ; Destination address required
   512                              <2>   %define   EMSGSIZE       90        ; Message too long
   513                              <2>   %define   EPROTOTYPE     91        ; Protocol wrong type for socket
   514                              <2>   %define   ENOPROTOOPT    92        ; Protocol not available
   515                              <2>   %define   EPROTONOSUPPORT     93   ; Protocol not supported
   516                              <2>   %define   ESOCKTNOSUPPORT     94   ; Socket type not supported
   517                              <2>   %define   EOPNOTSUPP     95        ; Operation not supported on transport endpoint
   518                              <2>   %define   EPFNOSUPPORT   96        ; Protocol family not supported
   519                              <2>   %define   EAFNOSUPPORT   97        ; Address family not supported by protocol
   520                              <2>   %define   EADDRINUSE     98        ; Address already in use
   521                              <2>   %define   EADDRNOTAVAIL  99        ; Cannot assign requested address
   522                              <2>   %define   ENETDOWN       100       ; Network is down
   523                              <2>   %define   ENETUNREACH    101       ; Network is unreachable
   524                              <2>   %define   ENETRESET      102       ; Network dropped connection because of reset
   525                              <2>   %define   ECONNABORTED   103       ; Software caused connection abort
   526                              <2>   %define   ECONNRESET     104       ; Connection reset by peer
   527                              <2>   %define   ENOBUFS        105       ; No buffer space available
   528                              <2>   %define   EISCONN        106       ; Transport endpoint is already connected
   529                              <2>   %define   ENOTCONN       107       ; Transport endpoint is not connected
   530                              <2>   %define   ESHUTDOWN      108       ; Cannot send after transport endpoint shutdown
   531                              <2>   %define   ETOOMANYREFS   109       ; Too many references: cannot splice
   532                              <2>   %define   ETIMEDOUT      110       ; Connection timed out
   533                              <2>   %define   ECONNREFUSED   111       ; Connection refused
   534                              <2>   %define   EHOSTDOWN      112       ; Host is down
   535                              <2>   %define   EHOSTUNREACH   113       ; No route to host
   536                              <2>   %define   EALREADY       114       ; Operation already in progress
   537                              <2>   %define   EINPROGRESS    115       ; Operation now in progress
   538                              <2>   %define   ESTALE         116       ; Stale NFS file handle
   539                              <2>   %define   EUCLEAN        117       ; Structure needs cleaning
   540                              <2>   %define   ENOTNAM        118       ; Not a XENIX named type file
   541                              <2>   %define   ENAVAIL        119       ; No XENIX semaphores available
   542                              <2>   %define   EISNAM         120       ; Is a named type file
   543                              <2>   %define   EREMOTEIO      121       ; Remote I/O error
   544                              <2>   %define   EDQUOT         122       ; Quota exceeded
   545                              <2>   %define   ENOMEDIUM      123       ; No medium found
   546                              <2>   %define   EMEDIUMTYPE    124       ; Wrong medium type
   547                              <2>   %define   ECANCELED      125       ; Operation Canceled
   548                              <2>   %define   ENOKEY         126       ; Required key not available
   549                              <2>   %define   EKEYEXPIRED    127       ; Key has expired
   550                              <2>   %define   EKEYREVOKED    128       ; Key has been revoked
   551                              <2>   %define   EKEYREJECTED   129       ; Key was rejected by service
   552                              <2> 
   553                              <2>   ; for robust mutexes
   554                              <2>   %define   EOWNERDEAD          130  ; Owner died
   555                              <2>   %define   ENOTRECOVERABLE     131  ; State not recoverable
   556                              <2>   %define   ERFKILL             132  ; Operation not possible due to RF-kill
   557                              <2>   %define   EHWPOISON           133  ; Memory page has hardware error
   558                              <2> 
   559                              <2> %elif
   560                              <2>   %warning "errors.inc already included" 
   561                              <2> %endif
   562                              <1> 
   563                              <1> %define SECONDS         1
   564                              <1> %define NANOSECONDS     0
   565                              <1> 
   566                              <1> %macro STRING 1
   567                              <1> .start:     db      %1
   568                              <1> .length:    equ     $-.start
   569                              <1> %endmacro
   570                              <1> 
   571                              <1> %macro syscall.write 1
   572                              <1>         mov     rsi, %1
   573                              <1>         mov     rdi, STDOUT
   574                              <1>         mov     rdx, %1.length
   575                              <1>         mov     rax, SYS_WRITE
   576                              <1>         syscall
   577                              <1> %endmacro
   578                              <1> 
   579                              <1> %macro syscall.nanosleep 2
   580                              <1>         mov     rdi, QWORD %1
   581                              <1> %if %2==0    
   582                              <1>         xor     rsi, rsi
   583                              <1> %elif
   584                              <1>         mov     rsi, %2
   585                              <1> %endif
   586                              <1>         mov     rax, SYS_NANOSLEEP
   587                              <1>         syscall
   588                              <1> %endmacro
   589                              <1> 
   590                              <1> %macro syscall.exit 1
   591                              <1> %if %1==0    
   592                              <1>         xor     rdi, rdi
   593                              <1> %elif
   594                              <1>         mov     rdi, %2
   595                              <1> %endif
   596                              <1>         mov     rax, SYS_EXIT
   597                              <1>         syscall
   598                              <1> %endmacro
   599                              <1> 
   600                              <1> %elif
   601                              <1>         %warning "sleep.inc already included"
   602                              <1> %endif
   603                                  
   604                                  BITS 64
   605                                  
   606                                  section .bss
   607                                      
   608                                  section .data
   609                                  
   610                                      message1 STRING {"sleeping for 5 seconds...", 10}
   611                              <1>  message1 :
   612 00000000 736C656570696E6720- <1> .start: db %1
   613 00000009 666F72203520736563- <1>
   614 00000012 6F6E64732E2E2E0A    <1>
   615                              <1> .length: equ $-.start
   616                                      message2 STRING {"back up and running.", 10}
   617                              <1>  message2 :
   618 0000001A 6261636B2075702061- <1> .start: db %1
   619 00000023 6E642072756E6E696E- <1>
   620 0000002C 672E0A              <1>
   621                              <1> .length: equ $-.start
   622                                      message3 STRING {"0",10}
   623                              <1>  message3 :
   624 0000002F 300A                <1> .start: db %1
   625                              <1> .length: equ $-.start
   626                                      TIMESPEC timer
   627                              <1>  %1: ISTRUC TIMESPEC_STRUC
   628 00000031 0000000000000000    <1>  at TIMESPEC_STRUC.tv_sec, dq %2
   629 00000039 0000000000000000    <1>  at TIMESPEC_STRUC.tv_nsec, dq %3
   630                              <1>  IEND
   631                              <1> 
   632                              <1>  %define %1.tv_sec %1+TIMESPEC_STRUC.tv_sec
   633                              <1>  %define %1.tv_nsec %1+TIMESPEC_STRUC.tv_nsec
   634                                  
   635                                  section .text
   636                                      global _start
   637                                  _start:
   638                                      
   639 00000000 48C70425[31000000]-         mov QWORD[timer.tv_sec], SECONDS
   640 00000008 01000000           
   641 0000000C 48C70425[39000000]-         mov QWORD[timer.tv_nsec], NANOSECONDS
   642 00000014 00000000           
   643 00000018 B90A000000                  mov     rcx, 10                             ; loop 10 times
   644                                  .repeat:    
   645 0000001D 51                          push    rcx
   646 0000001E 800C25[2F000000]31          or      BYTE[message3], "1"
   647                                      syscall.write message3
   648 00000026 48BE-               <1>  mov rsi, %1
   649 00000028 [2F00000000000000]  <1>
   650 00000030 BF01000000          <1>  mov rdi, STDOUT
   651 00000035 BA02000000          <1>  mov rdx, %1.length
   652 0000003A B801000000          <1>  mov rax, SYS_WRITE
   653 0000003F 0F05                <1>  syscall
   654                                      syscall.nanosleep timer, 0
   655 00000041 48BF-               <1>  mov rdi, QWORD %1
   656 00000043 [3100000000000000]  <1>
   657                              <1> %if %2==0
   658 0000004B 4831F6              <1>  xor rsi, rsi
   659                              <1> %elif
   660                              <1>  mov rsi, %2
   661                              <1> %endif
   662 0000004E B823000000          <1>  mov rax, SYS_NANOSLEEP
   663 00000053 0F05                <1>  syscall
   664 00000055 802425[2F000000]30          and     BYTE[message3], "0"
   665                                      syscall.write message3
   666 0000005D 48BE-               <1>  mov rsi, %1
   667 0000005F [2F00000000000000]  <1>
   668 00000067 BF01000000          <1>  mov rdi, STDOUT
   669 0000006C BA02000000          <1>  mov rdx, %1.length
   670 00000071 B801000000          <1>  mov rax, SYS_WRITE
   671 00000076 0F05                <1>  syscall
   672                                      syscall.nanosleep timer, 0
   673 00000078 48BF-               <1>  mov rdi, QWORD %1
   674 0000007A [3100000000000000]  <1>
   675                              <1> %if %2==0
   676 00000082 4831F6              <1>  xor rsi, rsi
   677                              <1> %elif
   678                              <1>  mov rsi, %2
   679                              <1> %endif
   680 00000085 B823000000          <1>  mov rax, SYS_NANOSLEEP
   681 0000008A 0F05                <1>  syscall
   682 0000008C 59                          pop     rcx
   683 0000008D E28E                        loop    .repeat
   684                                      
   685                                      
   686                                      ; syscall.write message2
   687                                      syscall.exit ENOERR
   688                              <1> %if %1==0
   689 0000008F 4831FF              <1>  xor rdi, rdi
   690                              <1> %elif
   691                              <1>  mov rdi, %2
   692                              <1> %endif
   693 00000092 B83C000000          <1>  mov rax, SYS_EXIT
   694 00000097 0F05                <1>  syscall
